<!DOCTYPE html>
<html>
<head>
	<style type="text/css">
        #canvas-container {
            position: relative;
            width: 1500px;
            height: 1500px;
            box-shadow: 0 0 5px 1px black;
            margin: 10px auto;
            border: 5px solid transparent;
        }
        #canvas-container.over {
            border: 5px dashed cyan;
        }
        #images img.img_dragging {
            opacity: 0.4;
        }
        /*
        Styles below based on  http://www.html5rocks.com/en/tutorials/dnd/basics/
        */

        /* Prevent the text contents of draggable elements from being selectable. */
        [draggable] {
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            user-select: none;
            /* Required to make elements draggable in old WebKit */
            -khtml-user-drag: element;
            -webkit-user-drag: element;
            cursor: move;
        }
    </style>

       <!--script src="https://code.jquery.com/jquery-1.12.0.min.js"></script-->
	<script type="text/javascript" src="bower_components/fabric.js/dist/fabric.min.js"></script>
	<title>Example Canvas </title>
</head>
<body>
	<button onclick="return removeTarget();"> Remove</button>

	<div id="images">
    <img  src="http://i.imgur.com/8rmMZI3.jpg" width="250" height="250"></img>
    <img draggable="true" src="http://i.imgur.com/q9aLMza.png" width="252" height="295"></img>
    <img draggable="true" src="http://i.imgur.com/wMU4SFn.jpg" width="238" height="319"></img>
    </div>

    <div id = "canvas-container">
		<canvas id="canvas" width="1500" height="1500"></canvas>
	</div>

</body>
<script type="text/javascript">
/* Drag and Drop code adapted from http://www.html5rocks.com/en/tutorials/dnd/basics/ */

var canvas = new fabric.Canvas('canvas'/*, { isDrawingMode : true}*/);

/* 
NOTE: the start and end handlers are events for the <img> elements; the rest are bound to the canvas container.
*/

function handleDragStart(e) {
    [].forEach.call(images, function (img) {
        img.classList.remove('img_dragging');
    });
    this.classList.add('img_dragging');
    console.log('handleDragStart', this);
}

function handleDragEnter(e) {
    // this / e.target is the current hover target.
    this.classList.add('over');
    console.log('handleDragEnter');
}

function handleDragOver(e) {
	console.log('handleDragOver');
    if (e.preventDefault) {
        e.preventDefault(); // Necessary. Allows us to drop.
    }

    e.dataTransfer.dropEffect = 'copy'; // See the section on the DataTransfer object.
    // NOTE: comment above refers to the article (see top) -natchiketa

    return false;
}

function handleDragLeave(e) {
	console.log('handleDragLeave');
    this.classList.remove('over'); // this / e.target is previous target element.
}

function handleDrop(e) {    
	console.log('handleDrop');
    // this / e.target is current target element.

    /*
    if (e.stopPropagation) {
        e.stopPropagation(); // stops the browser from redirecting.
    }
    */
    
    e.stopPropagation(); // Stops some browsers from redirecting.
    e.preventDefault(); // Stops some browsers from redirecting.

    // handle desktop images
    if(e.dataTransfer.files.length > 0){
               
        var files = e.dataTransfer.files;
        for (var i = 0, f; f = files[i]; i++) {
            
            // Only process image files.
            if (f.type.match('image.*')) {            
                // Read the File objects in this FileList.
                var reader = new FileReader();
                // listener for the onload event
                reader.onload = function(evt) {
                    // create img element
                    var img = document.createElement('img');
                    img.src= evt.target.result;                        
                    
                    // put image on canvas
                    var newImage = new fabric.Image(img, {
                        width: img.width,
                        height: img.height,
                        // Set the center of the new object based on the event coordinates relative to the canvas container.
                        left: e.layerX,
                        top: e.layerY
                    });
                    canvas.add(newImage);
                };
               // Read in the image file as a data URL.
               reader.readAsDataURL(f);
            }
        }
    }  
    // handle browser images
    else{        
       var img = document.querySelector('#images img.img_dragging');
        var newImage = new fabric.Image(img, {
            width: img.width,
            height: img.height,
            // Set the center of the new object based on the event coordinates relative to the canvas container.
            left: e.layerX,
            top: e.layerY
        });
        canvas.add(newImage); 
    } 
    
    return false;
}

function handleDragEnd(e) {
	console.log('handleDragEnd');
    // this/e.target is the source node.
    [].forEach.call(images, function (img) {
        img.classList.remove('img_dragging');
    });
}

//if (Modernizr.draganddrop) {
    // Browser supports HTML5 DnD.

    // Bind the event listeners for the image elements
    var images = document.querySelectorAll('#images img');
    [].forEach.call(images, function (img) {
        img.addEventListener('dragstart', handleDragStart, false);
        img.addEventListener('dragend', handleDragEnd, false);
    });

    // Bind the event listeners for the canvas
    var canvasContainer = document.getElementById('canvas-container');
    canvasContainer.addEventListener('dragenter', handleDragEnter, false);
    canvasContainer.addEventListener('dragover', handleDragOver, false);
    canvasContainer.addEventListener('dragleave', handleDragLeave, false);
    canvasContainer.addEventListener('drop', handleDrop, false);
/*} else {
    // Replace with a fallback to a library solution.
    alert("This browser doesn't support the HTML5 Drag and Drop API.");
}*/


function removeTarget() 
{
    var activeObject = canvas.getActiveObject(),
	    activeGroup = canvas.getActiveGroup();

	if (activeGroup || activeObject) {
		if (confirm('Are you sure ?')) {
			if (activeObject) {
				canvas.remove(activeObject);
			}

			if (activeGroup) {
				var listObjectActivity = activeGroup.getObjects();
				canvas.discardActiveGroup();
				listObjectActivity.forEach(function(object){
					canvas.remove(object);
				});
			}
		}
	}
}

</script>
</html>